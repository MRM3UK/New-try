<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIVE Sports From MsM</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/video.js/dist/video-js.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: #1a1a2e;
            color: #e0e0e0;
            margin: 0;
            padding: 0;
            transition: all 0.3s;
        }
        .light-theme { background: #ffffff; color: #000000; }
        .dark-theme { background: #1a1a2e; color: #e0e0e0; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .video-player { width: 100%; height: 400px; }
        .sidebar { width: 250px; background: #16213e; padding: 10px; position: fixed; height: 100%; overflow-y: auto; }
        .channel-list { margin-left: 260px; display: flex; flex-wrap: wrap; gap: 10px; }
        .channel-item { cursor: pointer; padding: 10px; background: #0f3460; border-radius: 5px; display: flex; align-items: center; }
        .channel-item.online::before { content: '●'; color: green; margin-right: 5px; }
        .channel-item.offline::before { content: '●'; color: red; margin-right: 5px; }
        .channel-item img { width: 50px; margin-right: 10px; }
        .chat-box { width: 300px; height: 400px; background: #0f3460; overflow-y: auto; position: fixed; right: 20px; top: 20px; padding: 10px; }
        .chat-messages { height: 300px; overflow-y: auto; }
        .chat-input { width: 100%; padding: 5px; margin-top: 10px; }
        .search-bar { width: 100%; padding: 10px; margin-bottom: 10px; }
        .category-btn { background: #2b4069; border: none; padding: 5px 10px; margin: 5px; cursor: pointer; }
        .theme-toggle { margin: 10px 0; }
        .history { margin-top: 20px; }
        .import-btn { margin-top: 10px; }
    </style>
</head>
<body class="dark-theme">
    <div class="sidebar">
        <h3>ক্যাটাগরি</h3>
        <button class="category-btn" onclick="filterCategory('Bangladesh')">Bangladesh</button>
        <button class="category-btn" onclick="filterCategory('India')">India</button>
        <input type="text" class="search-bar" placeholder="Search channels..." onkeyup="searchChannels()">
        <div id="channelCategories"></div>
    </div>
    <div class="container">
        <h1>LIVE Sports From MsM</h1>
        <div class="theme-toggle">
            <button onclick="toggleTheme()"><i class="fas fa-adjust"></i> Toggle Theme</button>
        </div>
        <video id="videoPlayer" class="video-js vjs-default-skin" controls autoplay>
            <source src="path/to/default.m3u8" type="application/x-mpegURL">
        </video>
        <div class="channel-list" id="channelList"></div>
        <div class="history" id="history">History: <span id="historyList"></span></div>
        <button class="import-btn" onclick="importPlaylist()">Import Playlist</button>
    </div>
    <div class="chat-box">
        <h3>লাইভ চ্যাট</h3>
        <div class="chat-messages" id="chatMessages"></div>
        <input type="text" class="chat-input" id="chatInput" placeholder="Type a message..." onkeypress="if(event.key === 'Enter') sendMessage()">
        <button onclick="sendMessage()">Send</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/video.js/dist/video.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script>
        var player = videojs('videoPlayer');
        const socket = io('https://your-chat-server.com'); // Replace with your WebSocket server

        // Sample channel data
        let channels = [
            { name: "DD National", logo: "dd-logo.png", url: "dd.m3u8", status: "online", category: "Bangladesh" },
            { name: "Zee News", logo: "zee-logo.png", url: "zee.m3u8", status: "offline", category: "India" },
            { name: "PTC Music", logo: "ptc-logo.png", url: "ptc.m3u8", status: "online", category: "India" },
            // Add more channels
        ];
        let history = JSON.parse(localStorage.getItem('watchHistory')) || [];

        function loadChannels(category = null) {
            const list = document.getElementById('channelList');
            list.innerHTML = '';
            const filtered = category ? channels.filter(ch => ch.category === category) : channels;
            filtered.forEach(channel => {
                const div = document.createElement('div');
                div.className = `channel-item ${channel.status}`;
                div.innerHTML = `<img src="${channel.logo}" onerror="this.src='default-logo.png'"> ${channel.name}`;
                div.onclick = () => {
                    playChannel(channel.url, channel.name);
                    updateHistory(channel.name);
                };
                list.appendChild(div);
            });
        }

        function playChannel(url, name) {
            player.src({ type: "application/x-mpegURL", src: url });
            player.play();
            document.title = `${name} - LIVE Sports From MsM`;
        }

        function searchChannels() {
            const input = document.querySelector('.search-bar').value.toLowerCase();
            const filtered = channels.filter(ch => ch.name.toLowerCase().includes(input));
            document.getElementById('channelList').innerHTML = '';
            filtered.forEach(ch => {
                const div = document.createElement('div');
                div.className = `channel-item ${ch.status}`;
                div.innerHTML = `<img src="${ch.logo}" onerror="this.src='default-logo.png'"> ${ch.name}`;
                div.onclick = () => playChannel(ch.url, ch.name);
                document.getElementById('channelList').appendChild(div);
            });
        }

        function filterCategory(category) {
            loadChannels(category);
        }

        function importPlaylist() {
            const url = prompt("Paste M3U/M3U8 playlist URL:");
            if (url) {
                fetch(url)
                    .then(response => response.text())
                    .then(data => {
                        const newChannels = parseM3U(data);
                        channels = [...channels, ...newChannels];
                        localStorage.setItem('channels', JSON.stringify(channels));
                        loadChannels();
                    })
                    .catch(err => alert('Failed to import playlist'));
            }
        }

        function parseM3U(data) {
            const lines = data.split('\n');
            const newChannels = [];
            for (let i = 0; i < lines.length; i++) {
                if (lines[i].startsWith('#EXTINF')) {
                    const name = lines[i].match(/tvg-name="([^"]+)"/)?.[1] || 'Unknown';
                    const logo = lines[i].match(/tvg-logo="([^"]+)"/)?.[1] || 'default-logo.png';
                    const url = lines[i + 1];
                    newChannels.push({ name, logo, url, status: "online", category: "Imported" });
                    i++;
                }
            }
            return newChannels;
        }

        function updateHistory(channel) {
            if (!history.includes(channel)) {
                history.push(channel);
                if (history.length > 10) history.shift(); // Limit history to 10 items
                localStorage.setItem('watchHistory', JSON.stringify(history));
                renderHistory();
            }
        }

        function renderHistory() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = history.map(ch => `<span onclick="playFromHistory('${ch}')">${ch}</span>`).join(', ');
        }

        function playFromHistory(name) {
            const channel = channels.find(ch => ch.name === name);
            if (channel) playChannel(channel.url, channel.name);
        }

        function toggleTheme() {
            document.body.classList.toggle('light-theme');
            document.body.classList.toggle('dark-theme');
        }

        function sendMessage() {
            const message = document.getElementById('chatInput').value;
            if (message) {
                socket.emit('chat message', message);
                document.getElementById('chatInput').value = '';
                addMessage(`You: ${message}`);
            }
        }

        function addMessage(message) {
            const messages = document.getElementById('chatMessages');
            messages.innerHTML += `<p>${message}</p>`;
            messages.scrollTop = messages.scrollHeight;
        }

        socket.on('chat message', function(msg) {
            addMessage(`User: ${msg}`);
        });

        // Check channel status (simulated)
        function checkChannelStatus() {
            channels.forEach(ch => {
                fetch(ch.url, { method: 'HEAD', mode: 'no-cors' })
                    .then(() => ch.status = 'online')
                    .catch(() => ch.status = 'offline')
                    .finally(() => loadChannels());
            });
        }
        setInterval(checkChannelStatus, 30000); // Check every 30 seconds

        // Load on startup
        window.onload = () => {
            loadChannels();
            renderHistory();
            checkChannelStatus();
        };
    </script>
</body>
</html>
